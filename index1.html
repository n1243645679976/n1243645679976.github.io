<!DOCTYPE html>
<html>
<head>
  <title>運動計時器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .timer-container {
      text-align: center;
      margin-top: 50px;
    }
    #timer-display {
      font-size: 48px;
    }
  </style>
</head>
<body>
  <div class="timer-container">
    <div>準備時間 (秒): <input type="number" id="prepare-time" value="10"></div>
    <div>鍛鍊時間 (秒): <input type="number" id="exercise-time" value="30"></div>
    <div>休息時間 (秒): <input type="number" id="rest-time" value="10"></div>
    <div>冷卻時間 (秒): <input type="number" id="cooldown-time" value="15"></div>
  <button onclick="startTimer()">開始</button>
  <div id="timer-display">00:00</div>
  </div>

  <script>
  let currentPhase = ''; // 紀錄當前的計時階段

  function startTimer() {
    const prepareTime = parseInt(document.getElementById('prepare-time').value);
    const exerciseTime = parseInt(document.getElementById('exercise-time').value);
    const restTime = parseInt(document.getElementById('rest-time').value);
    const cooldownTime = parseInt(document.getElementById('cooldown-time').value);

    const totalTime =
      prepareTime +
      (exerciseTime + restTime) * 3 +
      cooldownTime;

    let currentTime = totalTime;
    currentPhase = 'prepare'; // 設置當前階段為準備時間

    const timerInterval = setInterval(() => {
      currentTime--;

      if (currentTime === 0) {
        clearInterval(timerInterval);
        showNotification('計時結束');
      } else {
        if (currentPhase === 'prepare') {
          if (currentTime === prepareTime) {
            showNotification('開始鍛鍊');
          }
        } else if (currentPhase === 'exercise') {
          if (currentTime % (exerciseTime + restTime) === 0) {
            showNotification('休息時間');
          } else if (currentTime % (exerciseTime + restTime) === exerciseTime) {
            showNotification('開始鍛鍊');
          }
        }

        displayTime(currentTime);
        // 檢查是否要進入下一階段
        checkPhaseChange(currentTime, prepareTime, exerciseTime, restTime, cooldownTime);
      }
    }, 1000);
  }

  function checkPhaseChange(currentTime, prepareTime, exerciseTime, restTime, cooldownTime) {
    if (currentTime === prepareTime) {
      currentPhase = 'exercise';
    } else if (currentTime > prepareTime && currentTime <= prepareTime + exerciseTime) {
      currentPhase = 'exercise';
    } else if (
      currentTime > prepareTime + exerciseTime &&
      currentTime <= prepareTime + exerciseTime + restTime
    ) {
      currentPhase = 'rest';
    } else if (
      currentTime > prepareTime + exerciseTime + restTime &&
      currentTime <= prepareTime + exerciseTime + restTime + cooldownTime
    ) {
      currentPhase = 'cooldown';
    }
  }

  function displayTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    const formattedTime = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    document.getElementById('timer-display').innerText = formattedTime;
  }

    function showNotification(message) {
      if (Notification.permission !== 'granted') {
        Notification.requestPermission().then((permission) => {
          if (permission === 'granted') {
            new Notification(message);
          }
        });
      } else {
        new Notification(message);
      }
    }
  function displayTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    const formattedTime = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    document.getElementById('timer-display').innerText = formattedTime;
  }
  </script>
</body>
</html>